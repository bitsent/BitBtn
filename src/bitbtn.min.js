/*jshint esversion: 6 *//*
 * ---------------------------------------------------------------------
 *  BitBtn
 *
 *  Copyright 2019 Aleksandar Dinkov
 *
 *  URL: http://www.bitsent.net/bitbtn.html
 *
 *  Licensed under the OPEN ONLY-BSV-SPECIFIC LICENSE (v0.3.0):
 *    https://github.com/Pipe-Cash/OPEN-BLOCKCHAIN-SPECIFIC-LICENSE/releases/tag/v0.3.0
 *
 * ---------------------------------------------------------------------
 */bitbtn=function(){function i(){return(new Date).valueOf()/1e3|0}function l(){var e=document.createElement("a");e.type="button",e.classList.add("bitbtn");if(a=="iOS"||a=="Android"){var t=screen.width<screen.height,n=t?screen.width:screen.height,r=t?screen.height:screen.width;0<n&&n<500&&e.classList.add("bitbtn-phone"),499<n&&n<1e3&&e.classList.add("bitbtn-tablet")}var i=document.createElement("span");i.classList.add("status-circle"),i.role="status",i.append(" "),e.cleanupCircle=function(){i.classList.remove("success"),i.classList.remove("error"),i.classList.remove("loading")},e.setCircleStatus=function(t){e.cleanupCircle(),i.classList.add(t)},e.showSuccessInCircle=function(){e.setCircleStatus("success")},e.showErrorInCircle=function(){e.setCircleStatus("error")},e.showLoadingInCircle=function(){e.setCircleStatus("loading")},e.appendChild(i);var s=document.createElement("span");s.classList.add("bitbtn-amount"),e.appendChild(s),e.setAmount=function(e){s.innerHTML=e},e.setAmount("Loading...");var o=document.createElement("span");o.classList.add("bitbtn-label"),e.appendChild(o),e.setLabel=function(e){o.innerHTML=e},e.appLink="bitcoin:",e.setURI=function(t){e.appLink=t,e.href=t},e.setColors=function(t,n){t&&(e.style.backgroundColor=t),n&&(e.style.color=n)};var u=document.createElement("div");return u.classList.add("bitbtn-not-work"),u.append("Did it not work?"),u.onclick=function(t){t.stopPropagation(),e.showErrorInCircle(),b(e)},e.append(u),e.showNotWork=function(e){e=e||3,e=parseFloat(e),u.classList.add("show"),setTimeout(function(){u.classList.remove("show")},e*1e3)},e}function h(e,n){ensureParamsAreValid(n),e.params=n;var r=Math.round(e.params.amount*100)/100;e.setAmount(r+" "+e.params.currency.toUpperCase()),e.setLabel(e.params.label),e.setColors(n.backgroundColor,n.textColor);if(e.params.bip21===!0){var i=e.params.outputs[0];e.setURI("bitcoin:"+i.address+"?sv&amount="+i.sats/t+"&label="+encodeURIComponent(e.params.walletMemo))}else{var s=e.params.outputs.map(function(e){return{amount:e.sats,script:e.script}}),o=["req-bip275","paymentUrl="+encodeURIComponent(e.params.paymentUrl),"network="+encodeURIComponent(e.params.network),"outputs="+encodeURIComponent(JSON.stringify(s)),"creationTimestamp="+encodeURIComponent(e.params.creationTimestamp),"expirationTimestamp="+encodeURIComponent(e.params.expirationTimestamp),"memo="+encodeURIComponent(e.params.walletMemo)];e.params.merchantData!==undefined&&o.push("merchantData="+encodeURIComponent(e.params.merchantData)),e.setURI("bitcoin:?"+o.join("&"))}}function v(){p=!0}function m(){d=!0}function g(e,t,n){var r=e.appLink;if(!r)throw new TypeError("AppLink not present.");p=!1,d=!1,openDeepUri(r);var i=setTimeout(function(){p?(e.showNotWork(2),t()):d?e.showNotWork():a=="iOS"?e.showNotWork(5):n()},100)}function y(e){e.params.bip21&&console.error(new Error("BitBtn 'waitForPayment' cannot be implemented for BIP21 transactions!"))}function b(e){var t=a==="iOS"||a==="Android",n=e.params.bip21?"bip21":"bip275";y(e),f.showAlternatives(e.appLink,t,n)}function w(e){g(e,success=function(){e.params.bip21===!0?e.showSuccessInCircle():y(e)},failure=function(){e.showErrorInCircle(),b(e);var t=e.params.onError||function(e){};t(new Error("Did not detect app opening. Assuming that the user doesn't have a matching app."))})}function E(e,t){s(t.debug);try{var n=l();return e.appendChild(n),h(n,t),n.onclick=function(e){e.stopPropagation(),e.preventDefault(),w(e.currentTarget)},n}catch(r){var i=t.onError||function(e){};f.showError(r),i(r)}}var t=1e8,n="https://bitsent.net/",r="https://bitsent.net/wallets.html",s=function(){function n(){if(!document.getElementById(t)){var e=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id=t,n.rel="stylesheet",n.type="text/css",n.media="all",n.href="btnStyle.css",e.appendChild(n)}}function r(){if(!document.getElementById(t)){var n=document.getElementsByTagName("head")[0],r=document.createElement("style");r.id=t,r.innerHTML=e,n.appendChild(r)}}var e=".bitbtn{position:relative;padding:.4em .78em .55em .78em;line-height:1.5;display:inline-block;cursor:pointer;font-weight:400;text-align:center;vertical-align:middle;white-space:nowrap;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';text-decoration:none;border-radius:1.5em;background-color:#007bff;color:#fff}.bitbtn.hover{background-color:#007bff;color:#fff;text-decoration:none}.bitbtn span{margin:0 .15em;vertical-align:middle}@-webkit-keyframes bitbtn-spinner{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes bitbtn-spinner{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.bitbtn .status-circle{width:.5em;height:.5em;margin-right:4px;display:inline-block;vertical-align:text-bottom;border:.2em solid transparent;border-color:transparent;background-color:#fff;border-radius:50%;-webkit-animation:none;animation:none}.bitbtn .status-circle.loading{border:.2em solid currentColor;border-right-color:transparent;background-color:transparent;border-radius:50%;-webkit-animation:bitbtn-spinner .75s linear infinite;animation:bitbtn-spinner .75s linear infinite}.bitbtn .status-circle.success{border-color:transparent;background-color:#00ff84}.bitbtn .status-circle.error{border-color:transparent;background-color:#ff0400}.bitbtn .bitbtn-amount{font-size:11px;display:inline-block;background:#ffffff50;border-radius:10%;padding:0 4px;margin:0 2px}.bitbtn .bitbtn-amount:empty{margin:0;padding:0 1px 0 0}.bitbtn .bitbtn-not-work{background:#ddd;text-align:center;color:#000;display:none;position:absolute;left:0;top:3em;padding:10px;width:100%}.bitbtn .bitbtn-not-work.show{display:block}.bitbtn .small-text,.bitbtn-modal-container .small-text{font-size:.8em}.bitbtn-modal-container{background-color:#000;background-color:rgba(0,0,0,.4);position:fixed;left:0;top:0;width:100%;height:100%;display:none;z-index:2147483647;padding-top:100px;overflow:auto}.bitbtn-modal-container .modal-content{background-color:#fefefe;margin:auto;border:1px solid #888;width:500px;height:700px;max-width:70%;max-height:70vh;overflow-y:scroll;overflow-x:hidden}.bitbtn-modal-container .modal-header{display:block;background-color:#e6e6e6;position:sticky;top:0}.bitbtn-modal-container .modal-header button{padding:10px;background-color:#d1d1d1;border:0 none;margin:none}.bitbtn-modal-container .modal-header:hover button:hover{background-color:#b9b9b9}.bitbtn-modal-container .modal-header button.selected{background-color:#b9b9b9}.bitbtn-modal-container .modal-content .modal-body{padding:20px}.bitbtn-modal-container .close{color:#aaa;float:right;font-size:28px;font-weight:700}.bitbtn-modal-container .close:focus,.bitbtn-modal-container .close:hover{color:#000;text-decoration:none;cursor:pointer}.bitbtn-modal-container .wallet-list{list-style:none;display:flex;flex-wrap:wrap}.bitbtn-modal-container .wallet-list .wallet-item{display:inline-block;border:3px ridge #000;padding:1em 2em;margin:3px;text-align:center}.bitbtn-modal-container .wallet-list .wallet-item:hover{background:-moz-linear-gradient(-45deg,rgba(150,200,200,0) 0,rgba(150,200,200,1) 65%,rgba(150,200,200,0) 67%,rgba(150,200,200,0) 100%);background:-webkit-linear-gradient(-45deg,rgba(150,200,200,0) 0,rgba(150,200,200,1) 65%,rgba(150,200,200,0) 67%,rgba(150,200,200,0) 100%);background:linear-gradient(135deg,rgba(150,200,200,0) 0,rgba(150,200,200,1) 65%,rgba(150,200,200,0) 67%,rgba(150,200,200,0) 100%)}.bitbtn-modal-container .wallet-list .wallet-item img{height:3em}",t="bitbtn-css";return function(t){t?n():r()}}(),o=function(){function r(e,t){if(typeof Storage=="undefined")return;localStorage.setItem(t,e),localStorage.setItem(t+"_timestamp",i())}function s(e,t){if(typeof Storage=="undefined")return null;var n=localStorage.getItem(e),r=localStorage.getItem(e+"_timestamp");if(!n||!r)return null;var s=i();return s-t>r?null:s<r?null:JSON.parse(n)}function o(){var e=s("coinGeckoPrices",600);if(e)return e;var t=new XMLHttpRequest;t.open("GET",n,!1),t.send(null);if(t.readyState==4&&t.status==200){var i=t.responseText;return r(i,"coinGeckoPrices"),e=JSON.parse(i),e}throw new Error(t.statusText)}function u(n){n=n.toLowerCase().trim();if(!e.includes(n))throw new Error("Unknown currency: "+n);var r=o();return n.toLowerCase()=="bsv"?1:r[t][n]}var e=["usd","aed","ars","aud","bdt","bhd","bmd","brl","cad","chf","clp","cny","czk","dkk","eur","gbp","hkd","huf","idr","ils","inr","jpy","krw","kwd","lkr","mmk","mxn","myr","nok","nzd","php","pkr","pln","rub","sar","sek","sgd","thb","try","twd","uah","vef","vnd","zar","xdr","xag","xau"],t="bitcoin-cash-sv",n="https://api.coingecko.com/api/v3/simple/price?ids="+t+"&vs_currencies="+encodeURIComponent(e.join(","));return u}(),u=function(){var e,t=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return navigator.userAgent.match(/Edge/i)||navigator.userAgent.match(/Trident.*rv[ :]*11\./i)?e="msie":e=t[1].toLowerCase(),e}(),a=function(){var e=navigator.userAgent,t=[{s:"Windows",r:/(Windows)/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/}],n="Unknown";for(var r in t){var i=t[r];if(i.r.test(e)){n=i.s;break}}return n}(),f=function(){function e(e,t,n,r){var i=document.createElement(e);for(var s=0;s<t.length;s++){var o=t[s];i.classList.add(o)}for(var s=0;s<n.length;s++){var u=n[s];i.appendChild(u)}if(r){var a=document.createElement("div");a.innerHTML=r,i.append(a)}return i}function t(){var t=e("span",["close"],[],"×"),n=e("nav",["modal-header"],[]),r=e("div",["modal-body"],[]),i=e("div",["bitbtn-modal-container"],[e("div",["modal-content"],[t,n,r])]);return i.openTab=function(e,t){var n=i.querySelectorAll(".modal-header button");for(var r=0;r<n.length;r++)n[r].classList.remove("selected");e.classList.add("selected");var s=i.querySelectorAll(".tab"),o=i.querySelector(".tab."+t);for(var r=0;r<s.length;r++)s[r].style.display="none";o.style.display="block"},i.clearTabs=function(){while(n.hasChildNodes())n.removeChild(n.lastChild);while(r.hasChildNodes())r.removeChild(r.lastChild)},i.addTab=function(t,s,o){var u=e("button",[],[],t);u.onclick=function(e){i.openTab(u,s)},n.appendChild(u);var a=o.slice();a.unshift(e("h2",["tab-title"],[],t));var f=e("div",["tab",s],a);r.appendChild(f)},i.clickFirstTab=function(){var e=n.querySelectorAll("button")[0];e.click()},i.clickTab=function(e){var t=n.querySelectorAll("button")[e];t.click()},i}function l(f,l,c){var h=t(),p=e("a",["bitcoin-uri"],[],"Payment Request Link");p.rel="noopener noreferrer",p.target="_blank",p.href=f;var d=e("div",["bitsent-iframe"],[]);d.id="bitsentIFrameWrapper",d.style.display="none";var v=e("button",[],[],"Add BitSent as Handler");v.onclick=function(e){d.innerHTML="<iframe src='"+n+"'></iframe>"},h.addTab("BitSent","bitsent-handler-tab",[e("p",[],[],i[c]),e("p",[],[],s),v,d,e("p",[],[],u),e("p",["small-text"],[],o),e("p",[],[],"Once you are done, simply click on this link to try again:"),p]);var m=e("a",["wallet-list-link"],[],"BitSent's Reccomended Wallets");m.href=r+"?os="+encodeURIComponent(a)+"&uritype="+encodeURIComponent(c),m.rel="noopener noreferrer",m.target="_blank",h.addTab("Wallets","wallets",[e("p",[],[],i[c]),e("p",[],[],"Check the list of wallets reccomended by BitSent.NET:"),m]),l?h.clickTab(1):h.clickTab(0),showModalASAP(h)}function c(n){var r=t();r.addTab("Error","errorMessage",[e("p",[],[],n)]),r.clickTab(0),showModalASAP(r)}showModalASAP=function h(){function e(e){document.body.appendChild(e),e.style.display="block",modalCloseBtn=e.querySelector(".close"),modalCloseBtn.onclick=function(n){t(e)},window.addEventListener("click",function(n){n.target==e&&t(e)})}function t(t){try{t.parentNode.removeChild(t)}finally{modalsToShow.shift(),modalsToShow.length>0&&e(modalsToShow[0])}}function h(t){(function(){isModalShown=modalsToShow.length>0,modalsToShow.push(t),isModalShown||e(t)})()}return modalsToShow=[],h}();var i={bip21:"Looks like you don't have a wallet that supports 'BIP21' deep linking.",bip275:"Looks like you don't have a wallet that supports Bitcoin Request URI (BIP-275) deep linking."},s="You could add BitSent.NET as a handler for all 'bitcoin:' links. Just click the button bellow.",o="Keep in mind that this functionality is not supported on all browsers. Support is especially poor on mobile devices. If you are on a mobile device it is better to look for a wallet that supports this URI",u="Browsers don't always make it obvious that a website is requesting to handle a protocol. Look around your navigation bar for any new icons.";return f={showAlternatives:l,showError:c},f}();ensureParamsAreValid=function(){function n(t){if(typeof t!="object")throw new TypeError("BitBtn params must be a object!");"label"in t||(t.label="Send");if(typeof t.label!="string")throw new TypeError("BitBtn Label must be a string!");"network"in t||(t.network="bitcoin");if(typeof t.network!="string")throw new TypeError("BitBtn network must be a string!");"paymentUrl"in t||(t.paymentUrl="https://api.bitsent.net/payments/pay");if(typeof t.paymentUrl!="string")throw new TypeError("BitBtn paymentUrl must be a string!");if(t.paymentUrl.length>4e3)throw new RangeError("BitBtn 'paymentUrl' cannot be longer than 4000 characters");"creationTimestamp"in t||(t.creationTimestamp=Math.floor(+(new Date)/1e3));if(typeof t.creationTimestamp!="number")throw new TypeError("BitBtn creationTimestamp must be a number!");if(!("expirationTimestamp"in t)){var n=604800;t.expirationTimestamp=Math.floor(+(new Date)/1e3)+n}if(typeof t.expirationTimestamp!="number")throw new TypeError("BitBtn expirationTimestamp must be a number!");"walletMemo"in t||(t.walletMemo="BitBtn Payment");if(typeof t.walletMemo!="string")throw new TypeError("BitBtn 'walletMemo' must be a string.");if(t.walletMemo.length>50)throw new RangeError("BitBtn 'walletMemo' cannot be longer than 50 characters");if("merchantData"in t){typeof t.merchantData=="object"?t.merchantData=JSON.stringify(t.merchantData):t.merchantData=t.merchantData.toString();if(t.merchantData.length>1e4)throw new RangeError("BitBtn 'merchantData' cannot be longer than 10000 characters")}"successMessage"in t||(t.successMessage="Done!");if(typeof t.successMessage!="string")throw new TypeError("BitBtn SuccessMessage must be a string!");"onPayment"in t||(t.onPayment=function(e){});if(typeof t.onPayment!="function")throw new TypeError("BitBtn onPayment must be a function!");"onError"in t||(t.onError=function(e){});if(typeof t.onError!="function")throw new TypeError("BitBtn onError must be a function!");"bip21"in t||(t.bip21=!1);if(typeof t.bip21!="boolean")throw new TypeError("BitBtn 'bip21' must be a boolean.");if("outputs"in t){for(var i in e)if(e[i]in t)throw new Error("BitBtn with outputs cannot also have the following params: "+t.join(", "))}else{var s={};for(var i in e)e[i]in t&&(s[e[i]]=t[e[i]]);t.outputs=[s]}if(t.bip21===!0&&t.outputs.length>1)throw new Error("Cannot have multiple outputs when using BIP21");if(!Array.isArray(t.outputs))throw new TypeError("BitBtn outputs must be an array of objects!");for(var i in t.outputs){var o=t.outputs[i];if(typeof o!="object")throw new TypeError("BitBtn outputs must be an array of objects!");r(o)}t.currency=t.outputs[0].currency,t.amount=0;for(var i in t.outputs){if(t.outputs[i].currency!==t.currency&&t.outputs[i].amount!==0)throw new Error("All outputs must use the same currency");t.amount+=t.outputs[i].amount}if("textColor"in t&&typeof t.textColor!="string")throw new TypeError("textColor must be a string");if("backgroundColor"in t&&typeof t.backgroundColor!="string")throw new TypeError("backgroundColor must be a string")}function r(e){"amount"in e||(e.amount=0),typeof e.amount=="string"&&(e.amount=parseFloat(e.amount));if(typeof e.amount!="number")throw new TypeError("BitBtn output amount must be a positive number or 0!");if(e.amount===NaN||e.amount<0)throw new TypeError("BitBtn output amount must be a positive number or 0!");"currency"in e||(e.currency="bsv"),e.currency=e.currency.toLowerCase();if(typeof e.currency!="string")throw new TypeError("BitBtn currency must be a string!");var n=1;e.currency==="satoshi"?n=t:e.currency!=="bsv"&&(n=o(e.currency)),e.sats=Math.round(e.amount/n*t);if(!("address"in e)&&"paymail"in e)throw new Error("BitBtn doesn't support paymail yet.");if("address"in e&&"script"in e)throw new Error("The same BitBtn output cannot have an address and a script at the same time.");if(!("address"in e||"script"in e))throw new Error("A BitBtn output must have either an address or a script.");if("address"in e){if(typeof e.address!="string")throw new TypeError("BitBtn address must be a string.");if(!addrRegex.test(e.address))throw new Error("BitBtn address appears invalid: "+e.address);e.script=c.p2pkh(e.address)}if(!("script"in e))throw new Error("BitBtn output doesn't have (or didn't generate) a script.");e.script=e.script.trim().toLowerCase(),s(e)}function s(e){var t=e.script;if(t.length%2!=0)throw new SyntaxError("BitBtn - Script cannot have an odd number of letters : "+t);for(var n=0;n<t.length;n++)if(!i.includes(t[n]))throw new SyntaxError("BitBtn - Invalid script syntax : "+t)}var e=["address","amount","currency","script"];addrRegex=/[13][a-km-zA-HJ-NP-Z1-9]{25,34}/,scriptData=/(0x)?([0-9]|[A-F]|[a-f])+\b/;var i="0123456789abcdef".split("");return n}();var c=function(){function r(e){return Array.from(e,function(e){return("0"+(e&255).toString(16)).slice(-2)}).join("")}function i(e){var t=[];for(var n=0;n<e.length;n+=2)t.push(e.substr(n,2));return t.reverse().join("")}function u(e){e.length%2==1&&(e="0"+e);var t=e.length/2;if(e==="00")return"00";if(t<76)return("0"+t.toString(16)).slice(-2)+e;if(76<=t&&t<256)return"4c"+("0"+t.toString(16)).slice(-2)+e;if(256<=t&&t<s)return"4d"+i(("000"+t.toString(16)).slice(-4))+e;if(s<=t&&t<o)return"4e"+i(("0000000"+t.toString(16)).slice(-8))+e}function a(t){var i=n(t,e),s=i.slice(21),o=i.slice(1,21),a=r(o),f="76a9"+u(a)+"88ac";return f}function f(e){if(Array.isArray(e))return e.map(function(e){return f(e)});var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n).toString(16);t+=("0"+r).slice(-2)}return t}function l(e,t){t===undefined&&(t=!0),typeof e=="string"&&(e=[e]);if(!Array.isArray(e))throw new Error("op_return method expects an array of hexadecimal strings");var n=t?"006a":"6a";for(var r=0;r<e.length;r++)n+=u(e[r]);return n}var e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",t=function(e,t){var n=[],r="",i,s,o,u;for(i in e){s=0,o=e[i],r+=o||r.length^i?"":t[0];while(s in n||o)u=n[s],u=u?u*256+o:o,o=u/58|0,n[s]=u%58,s++}while(s--)r+=t[n[s]];return r},n=function(e,t){var n=[],r=[],i,s,o,u;for(i in e){s=0,o=t.indexOf(e[i]);if(o<0)return undefined;o||r.length^i?i:r.push(0);while(s in n||o)u=n[s],u=u?u*58+o:o,o=u>>8,n[s]=u%256,s++}while(s--)r.push(n[s]);return new Uint8Array(r)},s=Math.pow(16,4),o=Math.pow(16,8);return{p2pkh:a,op_return:l,str2hex:f}}();openDeepUri=function(){var e=function(e){console.error("App Links are not supported on this configuration")},t=function(e){window.location=e},n=t,r=function(e){var t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),t!==null&&(t.src=e)},i=function(e){var n=e.substr(0,e.indexOf(":")),r=e.substr(e.indexOf(":")+1),i="intent:"+r+"#Intent;scheme="+n+";end";t(i)},s=r;return a=="iOS"?s=n:a=="Android"?s=i:u=="chrome"&&(s=n),s}();var p=!1,d=!1;return window.addEventListener("pagehide",v,!1),window.addEventListener("blur",v,!1),window.addEventListener("beforeunload",m,!1),{create:E,getPrice:o,scripter:c}}();